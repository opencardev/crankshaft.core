# Project: Crankshaft
# This file is part of Crankshaft project.
# Copyright (C) 2025 OpenCarDev Team
#
#  Crankshaft is free software: you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation; either version 3 of the License, or
#  (at your option) any later version.
#
#  Crankshaft is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
#
#  You should have received a copy of the GNU General Public License
#  along with Crankshaft. If not, see <http://www.gnu.org/licenses/>.

# Crankshaft udev rules for Android Auto device access
# Grants USB access permissions for Android devices and triggers connection handlers

# Skip storage devices and non-USB subsystems
KERNEL=="sd*", GOTO="crankshaft_end"
KERNEL=="sg*", GOTO="crankshaft_end"
SUBSYSTEM!="usb", GOTO="crankshaft_end"

# Android device vendors
# Each rule grants permissions and triggers the USB action script

# Acer
SUBSYSTEM=="usb", ATTR{idVendor}=="0502", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# Allwinner
SUBSYSTEM=="usb", ATTR{idVendor}=="1f3a", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# Amlogic
SUBSYSTEM=="usb", ATTR{idVendor}=="1b8e", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# ASUS
SUBSYSTEM=="usb", ATTR{idVendor}=="0b05", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# Google (Pixel, Nexus)
SUBSYSTEM=="usb", ATTR{idVendor}=="18d1", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# HTC
SUBSYSTEM=="usb", ATTR{idVendor}=="0bb4", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# Huawei
SUBSYSTEM=="usb", ATTR{idVendor}=="12d1", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# Lenovo
SUBSYSTEM=="usb", ATTR{idVendor}=="17ef", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# LG
SUBSYSTEM=="usb", ATTR{idVendor}=="1004", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# Motorola
SUBSYSTEM=="usb", ATTR{idVendor}=="22b8", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# MediaTek (MTK)
SUBSYSTEM=="usb", ATTR{idVendor}=="0e8d", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# Nokia
SUBSYSTEM=="usb", ATTR{idVendor}=="0421", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# Nvidia
SUBSYSTEM=="usb", ATTR{idVendor}=="0955", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# OnePlus
SUBSYSTEM=="usb", ATTR{idVendor}=="2a70", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# OPPO
SUBSYSTEM=="usb", ATTR{idVendor}=="22d9", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# Qualcomm
SUBSYSTEM=="usb", ATTR{idVendor}=="05c6", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# Samsung
SUBSYSTEM=="usb", ATTR{idVendor}=="04e8", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# Sony
SUBSYSTEM=="usb", ATTR{idVendor}=="054c", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# Sony Ericsson
SUBSYSTEM=="usb", ATTR{idVendor}=="0fce", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# Xiaomi
SUBSYSTEM=="usb", ATTR{idVendor}=="2717", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# ZTE
SUBSYSTEM=="usb", ATTR{idVendor}=="19d2", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# Android Open Accessory (AOA) protocol - used by Android Auto
SUBSYSTEM=="usb", ATTR{idVendor}=="18d1", ATTR{idProduct}=="2d00", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"
SUBSYSTEM=="usb", ATTR{idVendor}=="18d1", ATTR{idProduct}=="2d01", MODE="0666", GROUP="plugdev", TAG+="uaccess", RUN+="/usr/lib/crankshaft/usb_action.sh add '$env{ID_MODEL}' '%E{DEVNAME}'"

# Handle device removal
SUBSYSTEM=="usb", ACTION=="remove", RUN+="/usr/lib/crankshaft/usb_action.sh remove '$env{ID_MODEL}' '%E{DEVNAME}'"

LABEL="crankshaft_end"
